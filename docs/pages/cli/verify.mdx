import { Callout } from "nextra/components";

# mud verify

This command uploads the source code for the deployed contracts to a public repository, such as a block explorer.
The repository then compiles the source code and verifies that the compiled version is identical to what is deployed onchain.

The best time to perform verification is immediately after [deployment](./deploy).
Verification only works with the original source code, compiler options, and compiled artifacts.
Otherwise, the generated bytecode is different and therefore verification fails.

<Callout type="info" emoji="ℹ️">
  Currently, on Etherscan and Blockscout `mud verify` verifies the `System`s that are part of your application, but not
  the MUD contracts themselves. On Sourcify `mud verify` verifies all the contracts.
</Callout>

## Using the command

1. If using Etherscan or Blockscout, specify the API key:

   ```sh copy
   export ETHERSCAN_API_KEY=<value goes here>
   ```

   With Blockscout you don't _have_ to specify the API key.
   However, there is a limited number of requests allowed for accounts without an API key per second, so you get much more reliable service if you do.

1. Run the command.

   ```sh copy
   pnpm mud verify --worldAddress <address here> --rpc <RPC to the blockchain> [--verifier <verifier>]
   ```

   These are the command line options you can specify on `mud verify`:

   | Option           | Meaning                                                | Type    | Default value                |
   | ---------------- | ------------------------------------------------------ | ------- | ---------------------------- |
   | `--worldAddress` | Verify the contracts of the World at the given address | string  | none, error if unspecified   |
   | `--configPath`   | Path to the config file                                | string  | `mud.config.ts`              |
   | `--verifier`     | The verifier to use (`sourcify`, or `blockscout`)      | string  | `blockscout`                 |
   | `--verifierUrl`  | URL to use to access the verifier's API                | string  | depends on the verifier used |
   | `--profile`      | The foundry profile to use                             | string  | `local`                      |
   | `--rpc`          | URL to the blockchain                                  | string  |                              |
   | `--srcDir`       | Source directory                                       | string  | Foundry `src` directory      |
   | `--version`      | Show version number                                    | boolean | `false`                      |

   Note that it takes block explorers some time to process new contracts.
   You should wait 5-10 minutes past deployment before you verify the contract on Etherscan and/or Blockscout.

## Examples

- To verify the world at that address on Holesky on [sourcify](https://sourcify.dev/):

  ```sh
  WORLD_ADDRESS=0x816038e244ff78b86a5e7dec9bf281634fb6d2a2
  HOLESKY_RPC=https://ethereum-holesky.publicnode.com
  pnpm mud verify --rpc $HOLESKY_RPC --worldAddress $WORLD_ADDRESS
  ```

- To verify a contract on Holesky for users of [Blockscout](https://www.blockscout.com/):

  ```sh
  WORLD_ADDRESS=0x816038e244ff78b86a5e7dec9bf281634fb6d2a2
  HOLESKY_RPC=https://ethereum-holesky.publicnode.com
  export ETHERSCAN_API_KEY= ** blockscout API key goes here **
  pnpm mud verify --rpc $HOLESKY_RPC --worldAddress $WORLD_ADDRESS --verifier blockscout --verifier-url https://eth-holesky.blockscout.com/api
  ```

## Verifying core contracts

Several core contracts are shared between all `World`s on a specific blockchain.
These contracts are not deployed the first time any MUD `World` is deployed on the blockchain, and they are stored at fixed addresses.

| Contract                 | Address<sup>1</sup>                                                                                                                           |
| ------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------- |
| CREATE2 deployer         | [`0x4e59b44847b379578588920ca78fbf26c0b4956c`](https://explorer.redstone.xyz/address/0x4e59b44847b379578588920ca78fbf26c0b4956c?tab=contract) |
| Access management system | [`0x17ffDEfF94ed0b80c493A179d4B3b09D6d71f627`](https://explorer.redstone.xyz/address/0x17ffDEfF94ed0b80c493A179d4B3b09D6d71f627?tab=contract) |
| Batch call system        | [`0x53E5c08d82A377167069Ade46d087Ab753538608`](https://explorer.redstone.xyz/address/0x53E5c08d82A377167069Ade46d087Ab753538608?tab=contract) |
| Balance transfer system  | [`0xA274B9a7E743cd8dF3c6Fd0aBD47eD55Fc943BC3`](https://explorer.redstone.xyz/address/0xA274B9a7E743cd8dF3c6Fd0aBD47eD55Fc943BC3?tab=contract) |
| Core registration system | [`0xd416f26aafcaaECa50b0dC35bd023e7286BE2961`](https://explorer.redstone.xyz/address/0xd416f26aafcaaECa50b0dC35bd023e7286BE2961?tab=contract) |
| Core module              | [`0xDa4E062e8C69D39d9472945232a53F579904AC45`](https://explorer.redstone.xyz/address/0xDa4E062e8C69D39d9472945232a53F579904AC45?tab=contract) |
| World factory            | [`0x573802f86c51B61d7Cf620952217eC6Ce0537d2E`](https://explorer.redstone.xyz/address/0x573802f86c51B61d7Cf620952217eC6Ce0537d2E?tab=contract) |

(1) These are the addresses for MUD version 2.0.11.
Future versions may have different addresses.

Because the source code of these contracts comes in a package in `node-modules` rather than as part of the `World` itself, by default `mud verify` does not verify them.

Here are the steps to verify these contracts if you deploy on a blockchain where they are not verified yet.

1. Go to [the releases page](https://github.com/latticexyz/mud/releases) and get the commit for the last release.
   At writing the release is 2.0.11, and the commit is `69b5c15c14fe3fe1db26cdcc19152fb044824a68`.

1. Ensure you have [all the prerequisited](/contribute#local-development-setup) installed.

1. Clone and build the MUD repository at that release

   ```sh copy
   git clone https://github.com/latticexyz/mud.git
   cd mud
   export COREPACK_ENABLE_STRICT=0
   git reset --hard 69b5c15c14fe3fe1db26cdcc19152fb044824a68
   pnpm install
   pnpm build
   ```

1.
